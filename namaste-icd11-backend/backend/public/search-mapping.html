<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAMASTE-ICD11 Terminology Mapping Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#10b981', // Ayurvedic green
                        secondary: '#3b82f6', // Medical blue
                        medical: '#3b82f6',
                        ayurvedic: '#10b981',
                        dark: '#1f2937',
                        light: '#f9fafb'
                    }
                }
            }
        }
    </script>
    <style>
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
        .glow {
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
        }
        .medical-glow {
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
        }
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .code-display {
            font-family: 'Courier New', monospace;
            background-color: #f3f4f6;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: bold;
        }
        .status-mapped {
            background-color: #dcfce7;
            color: #166534;
        }
        .status-not-found {
            background-color: #fee2e2;
            color: #b91c1c;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Global Header -->
    <header class="bg-white shadow-md border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-xl font-bold text-gray-900 flex items-center">
                            <i class="fas fa-heartbeat text-medical mr-2"></i>
                            <span class="text-medical">NAMASTE</span>
                            <span class="mx-2 text-gray-400">â†”</span>
                            <span class="text-ayurvedic">ICD-11</span>
                            <span class="ml-2 text-sm font-normal text-gray-500">Terminology Mapping Platform</span>
                        </h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="darkModeToggle" class="p-2 rounded-full hover:bg-gray-100">
                        <i class="fas fa-moon text-gray-600"></i>
                    </button>
                    <div class="relative">
                        <button class="flex text-sm rounded-full focus:outline-none">
                            <span class="inline-block h-8 w-8 rounded-full bg-ayurvedic text-white flex items-center justify-center">
                                <i class="fas fa-user-md"></i>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- App Shell Layout -->
    <div class="flex h-screen">
        <!-- Sidebar Navigation -->
        <nav class="w-64 bg-white shadow-md border-r border-gray-200">
            <div class="p-4">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Navigation</h2>
                <ul class="space-y-2">
                    <li>
                        <a href="dashboard.html" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-md">
                            <i class="fas fa-tachometer-alt mr-3 text-medical"></i>
                            Dashboard
                        </a>
                    </li>
                    <li>
                        <a href="#" class="flex items-center px-4 py-2 bg-ayurvedic bg-opacity-10 text-ayurvedic rounded-md font-medium">
                            <i class="fas fa-search mr-3 text-ayurvedic"></i>
                            Search & Mapping
                        </a>
                    </li>
                    <li>
                        <a href="terminology-explorer.html" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-md">
                            <i class="fas fa-book-medical mr-3 text-medical"></i>
                            Terminology Explorer
                        </a>
                    </li>
                    <li>
                        <a href="bulk-mapping.html" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-md">
                            <i class="fas fa-upload mr-3 text-ayurvedic"></i>
                            Bulk Mapping
                        </a>
                    </li>
                    <li>
                        <a href="about.html" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-md">
                            <i class="fas fa-info-circle mr-3 text-medical"></i>
                            About
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto p-6">
            <!-- Page Title -->
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Search & Mapping</h1>
                <p class="text-gray-600">Explore NAMASTE to ICD-11 terminology mappings</p>
            </div>

            <!-- Search Bar -->
            <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6 mb-8">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <input 
                            type="text" 
                            id="searchInput" 
                            placeholder="Search by term name (e.g., Amalaki, Triphala)" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ayurvedic focus:border-transparent text-lg"
                        >
                    </div>
                    <button id="searchBtn" class="bg-ayurvedic hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition duration-200 flex items-center text-lg">
                        <i class="fas fa-search mr-2"></i> Search
                    </button>
                </div>
            </div>

            <!-- Dual Result Panel -->
            <div id="resultPanels" class="hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Left Panel - NAMASTE -->
                    <div id="namastePanel" class="bg-white rounded-lg shadow-md border border-gray-200 p-6 slide-in">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-semibold text-gray-900 flex items-center">
                                <i class="fas fa-pills text-ayurvedic mr-2"></i>
                                NAMASTE
                            </h3>
                            <span id="namasteStatus" class="px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">Loaded</span>
                        </div>
                        
                        <div id="namasteContent" class="space-y-4">
                            <div class="text-center py-8 text-gray-500" id="namastePlaceholder">
                                <i class="fas fa-search text-3xl mb-2"></i>
                                <p>Search for a term to see NAMASTE details</p>
                            </div>
                            
                            <div id="namasteDetails" class="hidden">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Term Name</label>
                                    <p id="namasteName" class="text-lg font-semibold text-gray-900"></p>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">NAMASTE Code</label>
                                    <p id="namasteCode" class="code-display text-lg font-bold text-ayurvedic"></p>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                    <p id="namasteCategory" class="text-base text-gray-900"></p>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Definition</label>
                                    <p id="namasteDefinition" class="text-gray-700"></p>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Synonyms</label>
                                    <p id="namasteSynonyms" class="text-gray-700"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel - ICD-11 -->
                    <div id="icd11Panel" class="bg-white rounded-lg shadow-md border border-gray-200 p-6 slide-in">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-semibold text-gray-900 flex items-center">
                                <i class="fas fa-file-medical text-medical mr-2"></i>
                                ICD-11
                            </h3>
                            <span id="icd11Status" class="px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">Ready</span>
                        </div>
                        
                        <div id="icd11Content" class="space-y-4">
                            <div class="text-center py-8 text-gray-500" id="icd11Placeholder">
                                <i class="fas fa-map text-3xl mb-2"></i>
                                <p>ICD-11 mapping will appear here</p>
                            </div>
                            
                            <div id="icd11Details" class="hidden">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ICD-11 Code</label>
                                    <p id="icd11Code" class="code-display text-lg font-bold text-medical"></p>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ICD-11 Category</label>
                                    <p id="icd11Category" class="text-base text-gray-900"></p>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Mapping Type</label>
                                    <p class="text-base text-gray-900">
                                        <span class="inline-block px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                                            Indication-based semantic mapping
                                        </span>
                                    </p>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                    <p class="text-base text-gray-900">
                                        <span class="inline-block px-2 py-1 rounded-full text-xs font-medium status-mapped">
                                            Mapped
                                        </span>
                                    </p>
                                </div>
                            </div>
                            
                            <div id="noMapping" class="hidden text-center py-8 text-gray-500">
                                <i class="fas fa-exclamation-triangle text-3xl mb-2 text-yellow-500"></i>
                                <p>No ICD-11 mapping found for this term</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Save Bundle Button -->
                <div class="flex justify-center mb-8">
                    <button id="saveBundleBtn" class="bg-medical hover:bg-blue-700 text-white px-8 py-4 rounded-lg font-medium transition duration-200 flex items-center text-lg" disabled>
                        <i class="fas fa-save mr-3"></i> Save Bundle
                    </button>
                </div>

                <!-- Bundle Information -->
                <div id="bundleInfo" class="bg-blue-50 border border-blue-200 rounded-lg p-6 hidden">
                    <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-file-contract mr-2 text-medical"></i> FHIR Bundle Information
                    </h4>
                    <div id="bundleContent" class="text-gray-700 space-y-2">
                        <!-- Bundle info will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Recent Searches -->
            <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Searches</h3>
                <div id="recentSearches" class="space-y-2">
                    <div class="text-gray-500 text-center py-4">No recent searches yet</div>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Modal -->
    <div id="loadingModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl">
            <div class="flex items-center justify-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-ayurvedic"></div>
                <span class="ml-3 text-gray-700">Searching...</span>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // API base URL - adjust if needed
        const API_BASE_URL = 'http://localhost:3000';
        
        // DOM elements
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const resultPanels = document.getElementById('resultPanels');
        const namastePanel = document.getElementById('namastePanel');
        const icd11Panel = document.getElementById('icd11Panel');
        const namasteDetails = document.getElementById('namasteDetails');
        const icd11Details = document.getElementById('icd11Details');
        const namastePlaceholder = document.getElementById('namastePlaceholder');
        const icd11Placeholder = document.getElementById('icd11Placeholder');
        const noMapping = document.getElementById('noMapping');
        const saveBundleBtn = document.getElementById('saveBundleBtn');
        const bundleInfo = document.getElementById('bundleInfo');
        const bundleContent = document.getElementById('bundleContent');
        const loadingModal = document.getElementById('loadingModal');
        const recentSearches = document.getElementById('recentSearches');
        const namasteName = document.getElementById('namasteName');
        const namasteCode = document.getElementById('namasteCode');
        const namasteCategory = document.getElementById('namasteCategory');
        const namasteDefinition = document.getElementById('namasteDefinition');
        const namasteSynonyms = document.getElementById('namasteSynonyms');
        const icd11Code = document.getElementById('icd11Code');
        const icd11Category = document.getElementById('icd11Category');
        
        // Sample mapping data (in a real app, this would come from your mapping service)
        const sampleMappings = {
            'N0001': { code: 'DA61', category: 'Diseases of the digestive system', name: 'Amalaki' },
            'N0002': { code: 'DA61', category: 'Diseases of the digestive system', name: 'Haritaki' },
            'N0003': { code: 'MB24', category: 'Neurodevelopmental disorders', name: 'Ashwagandha' },
            'N0004': { code: 'DA61', category: 'Diseases of the digestive system', name: 'Triphala' },
            'N0005': { code: 'CA23', category: 'Diseases of the respiratory system', name: 'Bibhitaki' },
            'N0006': { code: 'MB20', category: 'Sleep disorders', name: 'Brahmi' },
            'N0007': { code: 'HA60', category: 'Diseases of the immune system', name: 'Guduchi' },
            'N0008': { code: 'GA34', category: 'Disorders of the female genital organs', name: 'Shatavari' },
            'N0009': { code: 'DA63', category: 'Diseases of the digestive system', name: 'Yashtimadhu' },
            'N0010': { code: '1F23', category: 'Certain infectious diseases', name: 'Nimba' }
        };
        
        // Current search result
        let currentSearchResult = null;
        let recentSearchList = JSON.parse(localStorage.getItem('recentSearches')) || [];
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            updateRecentSearches();
            
            // Check for search parameter in URL
            const urlParams = new URLSearchParams(window.location.search);
            const searchParam = urlParams.get('search');
            if (searchParam) {
                searchInput.value = searchParam;
                performSearch();
            }
        });
        
        // Show loading state
        function showLoading() {
            loadingModal.classList.remove('hidden');
        }
        
        // Hide loading state
        function hideLoading() {
            loadingModal.classList.add('hidden');
        }
        
        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `p-4 rounded-lg shadow-lg max-w-xs ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.getElementById('toastContainer').appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        // Update recent searches display
        function updateRecentSearches() {
            recentSearches.innerHTML = '';
            
            if (recentSearchList.length === 0) {
                recentSearches.innerHTML = '<div class="text-gray-500 text-center py-4">No recent searches yet</div>';
                return;
            }
            
            recentSearchList.slice(0, 5).forEach(search => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer';
                div.innerHTML = `
                    <span class="text-sm font-medium text-gray-900">${search.term}</span>
                    <span class="text-xs text-gray-500">${new Date(search.timestamp).toLocaleTimeString()}</span>
                `;
                div.addEventListener('click', () => {
                    searchInput.value = search.term;
                    performSearch();
                });
                recentSearches.appendChild(div);
            });
        }
        
        // Add to recent searches
        function addToRecentSearches(term) {
            const newSearch = {
                term: term,
                timestamp: new Date().toISOString()
            };
            
            // Add to beginning of array
            recentSearchList.unshift(newSearch);
            
            // Keep only the last 10 searches
            recentSearchList = recentSearchList.slice(0, 10);
            
            // Save to localStorage
            localStorage.setItem('recentSearches', JSON.stringify(recentSearchList));
            
            updateRecentSearches();
        }
        
        // Perform search
        async function performSearch() {
            const searchTerm = searchInput.value.trim();
            
            if (!searchTerm) {
                showToast('Please enter a search term', 'error');
                return;
            }
            
            showLoading();
            
            try {
                // Search for the term in the terminology
                const response = await fetch(`${API_BASE_URL}/ValueSet/$expand?filter=${encodeURIComponent(searchTerm)}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Check if we have results
                if (data.expansion && data.expansion.contains && data.expansion.contains.length > 0) {
                    const result = data.expansion.contains[0]; // Take the first match
                    
                    // Display NAMASTE details
                    namasteName.textContent = result.display || 'N/A';
                    namasteCode.textContent = result.code || 'N/A';
                    namasteCategory.textContent = result.category || 'N/A';
                    namasteDefinition.textContent = result.definition || 'No definition available';
                    namasteSynonyms.textContent = result.synonyms || 'No synonyms available';
                    
                    // Show NAMASTE details, hide placeholder
                    namasteDetails.classList.remove('hidden');
                    namastePlaceholder.classList.add('hidden');
                    
                    // Check for ICD-11 mapping
                    const mapping = sampleMappings[result.code];
                    if (mapping) {
                        // Show ICD-11 details
                        icd11Code.textContent = mapping.code;
                        icd11Category.textContent = mapping.category;
                        
                        // Show ICD-11 details, hide placeholders
                        icd11Details.classList.remove('hidden');
                        icd11Placeholder.classList.add('hidden');
                        noMapping.classList.add('hidden');
                        
                        // Enable save bundle button
                        saveBundleBtn.disabled = false;
                        
                        // Store current result for bundle creation
                        currentSearchResult = {
                            namaste: result,
                            icd11: mapping
                        };
                    } else {
                        // No mapping found
                        icd11Details.classList.add('hidden');
                        icd11Placeholder.classList.add('hidden');
                        noMapping.classList.remove('hidden');
                        
                        // Disable save bundle button
                        saveBundleBtn.disabled = true;
                        
                        currentSearchResult = {
                            namaste: result,
                            icd11: null
                        };
                    }
                    
                    // Show result panels
                    resultPanels.classList.remove('hidden');
                    
                    // Add to recent searches
                    addToRecentSearches(searchTerm);
                    
                } else {
                    // No results found
                    namasteDetails.classList.add('hidden');
                    namastePlaceholder.innerHTML = '<i class="fas fa-search text-3xl mb-2"></i><p>No results found for this search</p>';
                    namastePlaceholder.classList.remove('hidden');
                    
                    icd11Details.classList.add('hidden');
                    icd11Placeholder.innerHTML = '<i class="fas fa-map text-3xl mb-2"></i><p>No ICD-11 mapping available</p>';
                    icd11Placeholder.classList.remove('hidden');
                    noMapping.classList.add('hidden');
                    
                    resultPanels.classList.remove('hidden');
                    saveBundleBtn.disabled = true;
                    
                    showToast('No results found for your search', 'error');
                }
            } catch (error) {
                console.error('Error searching:', error);
                showToast(`Error searching: ${error.message}`, 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Save FHIR bundle
        async function saveBundle() {
            if (!currentSearchResult) {
                showToast('No search result to save', 'error');
                return;
            }
            
            showLoading();
            
            try {
                // Create a proper FHIR bundle with required resources
                const bundle = {
                    resourceType: 'Bundle',
                    type: 'transaction',
                    entry: [
                        {
                            fullUrl: `urn:uuid:${crypto.randomUUID ? crypto.randomUUID() : 'patient-1'}`,
                            resource: {
                                resourceType: 'Patient',
                                name: [{
                                    text: 'Demo Patient'
                                }],
                                gender: 'unknown'
                            },
                            request: {
                                method: 'POST',
                                url: 'Patient'
                            }
                        },
                        {
                            fullUrl: `urn:uuid:${crypto.randomUUID ? crypto.randomUUID() : 'encounter-1'}`,
                            resource: {
                                resourceType: 'Encounter',
                                status: 'finished',
                                subject: {
                                    reference: `Patient/${crypto.randomUUID ? crypto.randomUUID() : 'patient-1'}`
                                }
                            },
                            request: {
                                method: 'POST',
                                url: 'Encounter'
                            }
                        },
                        {
                            fullUrl: `urn:uuid:${crypto.randomUUID ? crypto.randomUUID() : 'condition-1'}`,
                            resource: {
                                resourceType: 'Condition',
                                code: {
                                    coding: [
                                        {
                                            system: 'http://namaste.gov.in/CodeSystem/namaste',
                                            code: currentSearchResult.namaste.code,
                                            display: currentSearchResult.namaste.display
                                        }
                                    ]
                                },
                                subject: {
                                    reference: `Patient/${crypto.randomUUID ? crypto.randomUUID() : 'patient-1'}`
                                },
                                encounter: {
                                    reference: `Encounter/${crypto.randomUUID ? crypto.randomUUID() : 'encounter-1'}`
                                },
                                verificationStatus: {
                                    coding: [{
                                        system: 'http://terminology.hl7.org/CodeSystem/condition-ver-status',
                                        code: 'confirmed',
                                        display: 'Confirmed'
                                    }]
                                }
                            },
                            request: {
                                method: 'POST',
                                url: 'Condition'
                            }
                        }
                    ]
                };
                
                // Send the bundle to the backend
                const response = await fetch(`${API_BASE_URL}/Bundle`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(bundle)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                // Check if the response is an OperationOutcome or a saved bundle
                if (result.resourceType === 'OperationOutcome') {
                    // Extract bundle ID and other info from the OperationOutcome
                    const outcomeDetails = JSON.parse(result.issue[0].details.text);
                    
                    // Display bundle info
                    bundleContent.innerHTML = `
                        <p><strong>Bundle ID:</strong> ${outcomeDetails.bundleId}</p>
                        <p><strong>Saved Condition:</strong> ${currentSearchResult.namaste.code} (${currentSearchResult.namaste.display}) with ICD-11 code ${outcomeDetails.derivedMappings?.match?.[0]?.code || 'Auto-mapped'}</p>
                        <p><strong>Status:</strong> <span class="text-green-600 font-medium">Successfully saved</span></p>
                    `;
                } else {
                    // For backward compatibility if the API returns the bundle directly
                    bundleContent.innerHTML = `
                        <p><strong>Bundle ID:</strong> ${result.id || 'Generated'}</p>
                        <p><strong>Saved Condition:</strong> ${currentSearchResult.namaste.code} (${currentSearchResult.namaste.display}) with ICD-11 code ${currentSearchResult.icd11?.code || 'Auto-mapped'}</p>
                        <p><strong>Status:</strong> <span class="text-green-600 font-medium">Successfully saved</span></p>
                    `;
                }
                
                bundleInfo.classList.remove('hidden');
                showToast('Bundle saved successfully!');
                
            } catch (error) {
                console.error('Error saving bundle:', error);
                showToast(`Error saving bundle: ${error.message}`, 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Event listeners
        searchBtn.addEventListener('click', performSearch);
        
        // Allow Enter key to trigger search
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
        
        // Save bundle button
        saveBundleBtn.addEventListener('click', saveBundle);
        
        // Dark mode toggle
        document.getElementById('darkModeToggle').addEventListener('click', function() {
            document.body.classList.toggle('bg-gray-900');
            document.body.classList.toggle('text-white');
        });
        
        // Global search shortcut (Ctrl + K)
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                searchInput.focus();
            }
        });
    </script>
</body>
</html>